# ============================================
# Global Settings
# ============================================
namespace: hiteen

nodeSelector:
  node-type: private

imagePullSecrets:
  - name: ghcr-secret

# ============================================
# Backend (Spring Boot)
# ============================================
app:
  name: hiteen-test
  replicaCount: 1
  image:
    repository: ghcr.io/gyu-hyung/hiteen-api
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8080
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: prod
    - name: REDIS_HOST
      value: redis-0.redis.hiteen.svc.cluster.local
    - name: REDIS_PORT
      value: "6379"
    - name: REDIS_PASSWORD
      valueFrom:
        secretKeyRef:
          name: redis-secret
          key: redis-password
    - name: FIREBASE_CREDENTIAL_PATH
      value: /app/firebase/firebase-key.json
  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi

# ============================================
# minIO (Assets)
# ============================================
minio:
  enabled: true
  image:
    repository: minio/minio
    tag: RELEASE.2025-10-01T23-13-49Z
    pullPolicy: IfNotPresent

  auth:
    rootUser: minioadmin
    rootPassword: minioadmin123

  mode: standalone   # ÌÖåÏä§Ìä∏ÎÇò ÎÇ¥Î∂ÄÏö©Ïù¥Î©¥ standaloneÏúºÎ°ú Ï∂©Î∂Ñ

  persistence:
    enabled: true
    size: 5Gi
    storageClass: "local-path"

  service:
    type: ClusterIP
    port: 9000
    annotations: {}

  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 250m

  console:
    enabled: true
    port: 9001
    ingress:
      enabled: true  # Ïô∏Î∂ÄÏóêÏÑú Ï†ëÏÜçÌïòÎ†§Î©¥ trueÎ°ú ÏÑ§Ï†ïÌïòÍ≥† host ÏßÄÏ†ï



# ============================================
# Soketi (WebSocket Server)
# ============================================
soketi:
  name: soketi
  replicaCount: 1
  image:
    repository: quay.io/soketi/soketi
    tag: 1.4-16-debian
    pullPolicy: Always

  # ‚úÖ Soketi ÏÑúÎπÑÏä§ Ï†ïÏùò
  service:
    name: soketi-svc        # üí° ÏÑúÎπÑÏä§ Ïù¥Î¶Ñ Î™ÖÏãú (DeploymentÏôÄ Îß§Ïπ≠)
    type: ClusterIP
    port: 6001

  # ‚úÖ ÌôòÍ≤Ω Î≥ÄÏàò
  env:
    - name: SOKETI_DEBUG
      value: "1"
    - name: SOKETI_DEFAULT_APP_ID
      value: hiteen-app
    - name: SOKETI_DEFAULT_APP_KEY
      value: hiteen-key
    - name: SOKETI_DEFAULT_APP_SECRET
      value: hiteen-secret
    - name: SOKETI_DEFAULT_APP_NAME
      value: hiteen
    - name: SOKETI_ADAPTER
      value: redis
    - name: SOKETI_REDIS_HOST
      value: redis-0.redis.hiteen.svc.cluster.local
    - name: SOKETI_REDIS_PORT
      value: "6379"
    - name: SOKETI_REDIS_PASSWORD
      valueFrom:
        secretKeyRef:
          name: redis-secret
          key: redis-password
    - name: SOKETI_DEFAULT_APP_ALLOW_ORIGIN
      value: "*"
    - name: SOKETI_DEFAULT_APP_ENABLE_CLIENT_MESSAGES
      value: "true"

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # ‚úÖ Soketi ÎÇ¥Î∂Ä ÏÑúÎπÑÏä§ Ï†ëÍ∑ºÏö© Host Ï†ïÎ≥¥ (SpringÏóêÏÑú Ï∞∏Í≥† Í∞ÄÎä•)
  host: soketi-svc.hiteen.svc.cluster.local


# ============================================
# Redis Cluster (StatefulSet + PVC)
# ============================================
redis:
  replicas: 6
  clusterReplicas: 1
  password: hiteen1234

  image:
    repository: redis
    tag: "7.2"
    pullPolicy: IfNotPresent

  service:
    port: 6379
    clusterPort: 16379

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi

  storageClass: local-path
  storageSize: 2Gi
  accessModes:
    - ReadWriteOnce

# ============================================
# Ingress (Nginx)
# ============================================
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/websocket-services: "soketi"
  hosts:
    - host:
      paths:
        - path: /
          pathType: Prefix
          backend:
            serviceName: hiteen-test
            servicePort: 8080
        - path: /apps
          pathType: Prefix
          backend:
            serviceName: soketi-svc
            servicePort: 6001
